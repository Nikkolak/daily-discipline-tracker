<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gvozdena Disciplina | Daily Progress</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#151e2e',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
            min-height: 100vh;
            background-image: 
                radial-gradient(at 0% 0%, rgba(56, 189, 248, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(168, 85, 247, 0.1) 0px, transparent 50%);
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .glass-card:hover {
            background: rgba(51, 65, 85, 0.7);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        .checkbox-wrapper input:checked + div {
            background-color: #10b981;
            border-color: #10b981;
        }
        
        .checkbox-wrapper input:checked + div svg {
            display: block;
        }
    </style>
</head>
<body class="antialiased pb-12">

    <!-- Header -->
    <header class="pt-8 pb-6 px-4 text-center">
        <h1 class="text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-purple-400 mb-2">
            DAILY DISCIPLINE
        </h1>
        <p class="text-slate-400 text-sm md:text-base font-medium" id="current-date">Fetching date...</p>
    </header>

    <main class="max-w-3xl mx-auto px-4 space-y-8">
        
        <!-- Monthly Stats -->
        <section class="grid grid-cols-3 gap-3 md:gap-4 animate-fade-in" style="animation-delay: 0.1s;">
            <div class="glass-card rounded-xl p-4 text-center flex flex-col items-center justify-center">
                <span class="text-3xl md:text-4xl mb-1">ü•á</span>
                <span class="text-xs text-slate-400 uppercase tracking-wider font-semibold">Gold</span>
                <span id="stat-gold" class="text-xl font-bold text-amber-400">0</span>
            </div>
            <div class="glass-card rounded-xl p-4 text-center flex flex-col items-center justify-center">
                <span class="text-3xl md:text-4xl mb-1">ü•à</span>
                <span class="text-xs text-slate-400 uppercase tracking-wider font-semibold">Silver</span>
                <span id="stat-silver" class="text-xl font-bold text-slate-300">0</span>
            </div>
            <div class="glass-card rounded-xl p-4 text-center flex flex-col items-center justify-center">
                <span class="text-3xl md:text-4xl mb-1">ü•â</span>
                <span class="text-xs text-slate-400 uppercase tracking-wider font-semibold">Bronze</span>
                <span id="stat-bronze" class="text-xl font-bold text-orange-400">0</span>
            </div>
        </section>

        <!-- Quote Card -->
        <section id="quote-section" class="glass-panel rounded-2xl p-6 text-center border-l-4 border-l-sky-500 animate-fade-in" style="animation-delay: 0.2s;">
            <p id="motivation-quote" class="text-lg md:text-xl font-semibold italic text-slate-100 mb-2">
                "Pad nije poraz, poraz je ako sutra ne ustane≈°. Resetuj se!"
            </p>
            <div id="streak-badge" class="hidden inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-amber-500/20 text-amber-300 border border-amber-500/30 mt-2">
                üî• 3 DAY STREAK
            </div>
        </section>

        <!-- Today's Progress -->
        <section class="glass-panel rounded-2xl p-6 animate-fade-in" style="animation-delay: 0.3s;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-slate-100 flex items-center gap-2">
                    <span>üìÖ</span> Today's Focus
                </h2>
                <div id="today-medal" class="text-3xl opacity-50 grayscale transition-all duration-500">ü•á</div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-slate-700/50 rounded-full h-4 mb-6 relative overflow-hidden">
                <div id="progress-bar" class="bg-gradient-to-r from-sky-500 to-purple-500 h-4 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>

            <!-- Habit List -->
            <div id="habit-list" class="space-y-3 mb-6">
                <!-- Habits injected here -->
            </div>

            <!-- Add Habit Input -->
            <div class="flex gap-2 mb-6">
                <input type="text" id="new-habit-input" placeholder="New habit (e.g. Read 20 mins)" 
                    class="flex-1 bg-slate-800/50 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500 transition-colors text-sm">
                <button onclick="app.addHabit()" 
                    class="bg-sky-600 hover:bg-sky-500 text-white px-5 rounded-lg font-medium transition-colors">
                    Add
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="pt-4 border-t border-slate-700/50 flex justify-end">
                <button onclick="app.archiveDay()" 
                    class="group relative inline-flex items-center justify-center px-6 py-3 text-sm font-bold text-white transition-all duration-200 bg-gradient-to-r from-indigo-600 to-purple-600 font-pj rounded-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-600">
                    <span class="absolute inset-0 w-full h-full -mt-1 rounded-lg opacity-30 bg-gradient-to-b from-transparent via-transparent to-black"></span>
                    <span class="relative flex items-center gap-2">
                        Finish & Start New Day ‚û°Ô∏è
                    </span>
                </button>
            </div>
        </section>

        <!-- History -->
        <section class="animate-fade-in" style="animation-delay: 0.4s;">
            <h2 class="text-lg font-bold text-slate-300 mb-4 px-2">History & Archive</h2>
            <div id="history-list" class="space-y-3">
                <!-- History items injected here -->
                <div class="text-center text-slate-500 py-4 italic text-sm">No history yet. Start crushing your goals!</div>
            </div>
        </section>

    </main>

    <footer class="mt-12 text-center text-slate-600 text-sm pb-8">
        <p>Built for Discipline.</p>
    </footer>

    <!-- Application Logic -->
    <script>
        const STORAGE_KEY = 'daily_discipline_app_v1';
        
        // --- Confetti Effect ---
        function runCelebration() {
            const duration = 3000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            function random(min, max) { return Math.random() * (max - min) + min; }
            function randomInRange(min, max) { return Math.random() * (max - min) + min; }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) { return clearInterval(interval); }
                const particleCount = 50 * (timeLeft / duration);
                
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        // --- Quotes ---
        const QUOTES = {
            gold: "Gvozdena disciplina! Danas si bio bolji od 99% ljudi.",
            silver: "Odliƒçan posao, ali sutra nemoj tra≈æiti izgovore za onih par procenata.",
            bronze: "Dobro je, ali mo≈æe≈° bolje. Disciplina je most izmeƒëu ciljeva i dostignuƒáa.",
            low: "Pad nije poraz, poraz je ako sutra ne ustane≈°. Resetuj se!",
            streak: "NEZAUSTAVLJIV SI! Kralj discipline."
        };

        // --- App Class ---
        class DisciplineApp {
            constructor() {
                this.state = {
                    habits: ['Reading (20m)', 'Workout', 'Deep Work (2h)'], // Default habits
                    currentDay: {}, // Map habitIndex -> boolean
                    history: [], // Array of objects { date, habits: [], percentage, medal }
                    lastActiveDate: new Date().toLocaleDateString()
                };
                
                this.init();
            }

            init() {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // Merge saved state carefully to allow schema updates if needed
                    this.state = { ...this.state, ...parsed };
                    
                    // Reset toggles if it's a naturally new day? 
                    // Prompt implies manual "Start New Day", so we keep current state until user resets.
                    // But let's check if the date stored matches today for display purposes
                } else {
                    // First run
                }

                this.render();
                this.setupEnterKey();
            }

            save() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(this.state));
            }

            setupEnterKey() {
                document.getElementById('new-habit-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addHabit();
                });
            }

            // --- Core Logic ---

            addHabit() {
                const input = document.getElementById('new-habit-input');
                const name = input.value.trim();
                if (!name) return;

                this.state.habits.push(name);
                input.value = '';
                this.save();
                this.render();
            }

            removeHabit(index) {
                if(confirm('Delete this habit?')) {
                    const habitName = this.state.habits[index];
                    this.state.habits.splice(index, 1);
                    // Also clean up current day state for this index (re-keying required if using index)
                    // Since we use index for toggle state, removing an item shifts indices.
                    // We need to rebuild currentDay object.
                    // Actually, let's migrate `currentDay` to be an array of booleans matching habits array length
                    // Or reset currentDay for the shift. 
                    // For simplicity in single file: Let's clean currentDay completely on structural change to avoid bugs,
                    // or try to preserve by name? Preserving by index is buggy if we splice.
                    // Let's just reset the specific toggle map for safety or do a smart remap.
                    // Simplest approach: Delete the key from currentDay, but keys are indices.
                    // Let's wipe currentDay progress for the deleted item and shift others? 
                    // To keep it robust: Use habit name as key? No, duplicates allowed? 
                    // Let's assume unique names or allow simple index shift reset.
                    // DECISION: When deleting, just re-render. The `currentDay` map uses indices. 
                    // If I delete index 0, old index 1 becomes 0. The checkmark for old 1 will apply to new 0. 
                    // This is bad.
                    // FIX: Re-construct `currentDay` map.
                    const newCurrentDay = {};
                    let oldIdx = 0;
                    let newIdx = 0;
                    // This is complex without IDs.
                    // ALTERNATIVE: `currentDay` tracks completion by Habit NAME.
                    // Let's migrate to using Habit Names as keys for `currentDay`.
                }
            }

            // Simpler remove implementation:
            deleteHabit(index) {
                // To avoid index shifting issues with simple arrays, 
                // we'll just clear the progress for today when modifying structure
                // or ideally implement IDs. 
                // Let's keep it simple: Remove from array, save.
                // NOTE: This might shift checkmarks if we don't track by ID. 
                // For this MVP, let's accept that rearranging habits might require re-checking.
                this.state.habits.splice(index, 1);
                
                // Clear out index-based keys from currentDay that are out of bounds or shift them?
                // Let's just reset currentDay to match the new size to be safe/clean?
                // Or better: let's migrate `currentDay` to use names.
                // Refactoring `currentDay` to use names in `toggleHabit`.
                
                this.save();
                this.render();
            }

            toggleHabit(index) {
                // Using index as key for simplicity in MVP
                const key = index.toString();
                this.state.currentDay[key] = !this.state.currentDay[key];
                
                // Check for celebration
                const stats = this.calculateStats();
                if (this.state.currentDay[key] && stats.percentage === 100) {
                    runCelebration();
                }

                this.save();
                this.render();
            }

            calculateStats() {
                const total = this.state.habits.length;
                if (total === 0) return { count: 0, percentage: 0 };
                
                let completed = 0;
                this.state.habits.forEach((_, idx) => {
                    if (this.state.currentDay[idx]) completed++;
                });

                return {
                    count: completed,
                    total: total,
                    percentage: Math.round((completed / total) * 100)
                };
            }

            getMedal(percentage) {
                if (percentage === 100) return 'ü•á';
                if (percentage >= 90) return 'ü•à';
                if (percentage >= 80) return 'ü•â';
                return null;
            }

            archiveDay() {
                const stats = this.calculateStats();
                const medal = this.getMedal(stats.percentage);
                const date = new Date().toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });
                
                // Construct history entry
                const entry = {
                    id: Date.now(),
                    date: date,
                    habitsSnapshot: [...this.state.habits], // Save what habits were present
                    completedCount: stats.count,
                    totalCount: stats.total,
                    percentage: stats.percentage,
                    medal: medal
                };

                // Add to history (newest first)
                this.state.history.unshift(entry);
                
                // Reset current day
                this.state.currentDay = {};
                
                this.save();
                this.render();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            getStreak() {
                let streak = 0;
                for (const day of this.state.history) {
                    if (day.percentage === 100) {
                        streak++;
                    } else {
                        break;
                    }
                }
                return streak;
            }

            // --- Rendering ---

            render() {
                // 1. Date
                document.getElementById('current-date').textContent = new Date().toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                // 2. Habits List
                const list = document.getElementById('habit-list');
                list.innerHTML = '';
                
                this.state.habits.forEach((habit, index) => {
                    const isChecked = !!this.state.currentDay[index];
                    
                    const div = document.createElement('div');
                    div.className = `glass-card rounded-xl p-4 flex items-center justify-between group transition-all duration-300 ${isChecked ? 'bg-slate-800/80 border-sky-500/30' : ''}`;
                    
                    div.innerHTML = `
                        <div class="flex items-center gap-4 flex-1 cursor-pointer" onclick="app.toggleHabit(${index})">
                            <div class="checkbox-wrapper relative w-6 h-6">
                                <input type="checkbox" ${isChecked ? 'checked' : ''} class="peer appearance-none w-6 h-6 border-2 border-slate-500 rounded-md checked:bg-sky-500 checked:border-sky-500 transition-colors cursor-pointer absolute inset-0 opacity-0 z-10">
                                <div class="w-6 h-6 border-2 border-slate-500 rounded-md peer-checked:bg-sky-500 peer-checked:border-sky-500 transition-colors flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white hidden pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                            </div>
                            <span class="text-lg ${isChecked ? 'text-slate-400 line-through decoration-slate-600' : 'text-slate-200'} transition-all">${habit}</span>
                        </div>
                        <button onclick="event.stopPropagation(); app.deleteHabit(${index})" class="text-slate-600 hover:text-red-400 p-2 opacity-0 group-hover:opacity-100 transition-opacity" title="Remove habit">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    `;
                    list.appendChild(div);
                });

                // 3. Progress & Stats
                const stats = this.calculateStats();
                const progressBar = document.getElementById('progress-bar');
                progressBar.style.width = `${stats.percentage}%`;
                
                // Color change based on progress
                if (stats.percentage === 100) {
                    progressBar.className = 'bg-gradient-to-r from-amber-400 to-yellow-600 h-full rounded-full transition-all duration-500';
                } else if (stats.percentage >= 80) {
                     progressBar.className = 'bg-gradient-to-r from-sky-400 to-blue-600 h-full rounded-full transition-all duration-500';
                } else {
                     progressBar.className = 'bg-gradient-to-r from-slate-500 to-slate-400 h-full rounded-full transition-all duration-500';
                }

                // Current Day Medal
                const todayMedalEl = document.getElementById('today-medal');
                const earnedMedal = this.getMedal(stats.percentage);
                if (earnedMedal) {
                    todayMedalEl.textContent = earnedMedal;
                    todayMedalEl.classList.remove('opacity-50', 'grayscale');
                    todayMedalEl.classList.add('scale-110');
                } else {
                    todayMedalEl.textContent = 'ü•á';
                    todayMedalEl.classList.add('opacity-50', 'grayscale');
                    todayMedalEl.classList.remove('scale-110');
                }

                // 4. Motivation & Quote
                const quoteEl = document.getElementById('motivation-quote');
                const streakBadge = document.getElementById('streak-badge');
                
                // Check Streak (from history + today possibility)
                // Actually streak is strictly based on history, or history + today if today is 100%?
                // Let's count history.
                const historyStreak = this.getStreak();
                const isTodayGold = stats.percentage === 100;
                const totalStreak = isTodayGold ? historyStreak + 1 : historyStreak;

                if (totalStreak >= 3) {
                    quoteEl.textContent = `"${QUOTES.streak}"`;
                    quoteEl.className = "text-lg md:text-xl font-bold italic text-amber-300 mb-2";
                    streakBadge.classList.remove('hidden');
                    streakBadge.textContent = `üî• ${totalStreak} DAY STREAK`;
                } else {
                    streakBadge.classList.add('hidden');
                    quoteEl.className = "text-lg md:text-xl font-semibold italic text-slate-100 mb-2";
                    
                    if (stats.percentage === 100) quoteEl.textContent = `"${QUOTES.gold}"`;
                    else if (stats.percentage >= 90) quoteEl.textContent = `"${QUOTES.silver}"`;
                    else if (stats.percentage >= 80) quoteEl.textContent = `"${QUOTES.bronze}"`;
                    else quoteEl.textContent = `"${QUOTES.low}"`;
                }

                // 5. Monthly Stats (Aggregated from History)
                let golds = 0, silvers = 0, bronzes = 0;
                // Filter for current month logic could be added here, 
                // for now we just sum all history as "Total Stats" or simple monthly logic
                const currentMonth = new Date().getMonth();
                
                this.state.history.forEach(day => {
                    // primitive month check
                    // const dayDate = new Date(day.date); // This might fail with "short" format depending on locale
                    // Let's just count all for this simple version or try to parse
                    // For MVP simplicity: All Time Stats (renaming UI slightly in mind if needed, but Prompt asked "Monthly")
                    // Let's assume history is usually small or clearable. 
                    if (day.medal === 'ü•á') golds++;
                    if (day.medal === 'ü•à') silvers++;
                    if (day.medal === 'ü•â') bronzes++;
                });
                
                document.getElementById('stat-gold').textContent = golds;
                document.getElementById('stat-silver').textContent = silvers;
                document.getElementById('stat-bronze').textContent = bronzes;

                // 6. Render History List
                const historyEl = document.getElementById('history-list');
                historyEl.innerHTML = '';
                
                if (this.state.history.length === 0) {
                    historyEl.innerHTML = '<div class="text-center text-slate-500 py-4 italic text-sm">No history yet. Start crushing your goals!</div>';
                } else {
                    this.state.history.forEach(day => {
                        const row = document.createElement('div');
                        row.className = 'glass-card rounded-lg p-4 flex items-center gap-4 animate-fade-in';
                        
                        let barColor = 'bg-slate-600';
                        if (day.percentage === 100) barColor = 'bg-amber-400';
                        else if (day.percentage >= 80) barColor = 'bg-sky-400';

                        row.innerHTML = `
                            <div class="w-16 flex-shrink-0 flex flex-col items-center">
                                <span class="text-2xl">${day.medal || 'üìù'}</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-end mb-1">
                                    <span class="font-medium text-slate-200 text-sm">${day.date}</span>
                                    <span class="text-xs font-mono text-slate-400">${day.percentage}%</span>
                                </div>
                                <div class="w-full bg-slate-700/50 rounded-full h-2">
                                    <div class="${barColor} h-2 rounded-full" style="width: ${day.percentage}%"></div>
                                </div>
                            </div>
                        `;
                        historyEl.appendChild(row);
                    });
                }
            }
        }

        // Initialize App
        const app = new DisciplineApp();
    </script>
</body>
</html>
